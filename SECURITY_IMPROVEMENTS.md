# π”’ λ³΄μ• κ°μ„  μ‚¬ν•­ μ μ© κ°€μ΄λ“

## μ μ©λ λ³΄μ• κ°μ„  μ‚¬ν•­

### 1λ‹¨κ³„: κΈ°λ³Έ λ³΄μ• κ°•ν™” (μ™„λ£)

#### β… RLS μ •μ±… λΉ„ν™μ„±ν™”
- **νμΌ**: `supabase/disable-rls-policies.sql`
- **μ„¤λ…**: μ»¤μ¤ν…€ μΈμ¦μ„ μ‚¬μ©ν•λ―€λ΅ API λ λ²¨μ—μ„λ§ κ¶ν• μ²΄ν¬
- **μ μ© λ°©λ²•**: Supabase SQL Editorμ—μ„ μ‹¤ν–‰

#### β… HTTPS κ°•μ 
- **νμΌ**: `middleware.ts`
- **μ„¤λ…**: ν”„λ΅λ•μ… ν™κ²½μ—μ„ HTTP μ ‘κ·Ό μ‹ HTTPSλ΅ μλ™ λ¦¬λ‹¤μ΄λ ‰νΈ
- **μλ™ μ μ©**: λ°°ν¬ μ‹ μλ™μΌλ΅ μ‘λ™

#### β… API μ ‘κ·Ό λ΅κΉ… κ°•ν™”
- **μ„¤λ…**: λ„¤μ΄λ²„ μ •λ³΄ μ΅°ν μ‹ μλ™μΌλ΅ λ΅κ·Έ κΈ°λ΅
- **μ„μΉ**: `app/api/users/route.ts`, `app/api/users/[id]/route.ts`

---

### 2λ‹¨κ³„: κ°μΈμ •λ³΄ μ•”νΈν™” (μ™„λ£)

#### β… λ„¤μ΄λ²„ λΉ„λ°€λ²νΈ μ•”νΈν™”
- **νμΌ**: 
  - `lib/encryption.ts` - μ•”νΈν™”/λ³µνΈν™” μ ν‹Έλ¦¬ν‹°
  - `app/api/users/route.ts` - μƒμ„± μ‹ μ•”νΈν™”
  - `app/api/users/[id]/route.ts` - μμ • μ‹ μ•”νΈν™”
- **μ•”νΈν™” λ°©μ‹**: AES-256-GCM
- **μλ™ λ³µνΈν™”**: μ΅°ν μ‹ μλ™μΌλ΅ λ³µνΈν™”ν•μ—¬ ν‘μ‹ (κ΄€λ¦¬μλ§)

#### π”„ κΈ°μ΅΄ λ°μ΄ν„° λ§μ΄κ·Έλ μ΄μ…
- **νμΌ**: `scripts/migrate-naver-passwords.js`
- **μ‚¬μ©λ²•**:
  ```bash
  # ν™κ²½ λ³€μ μ„¤μ • ν™•μΈ
  # .env.localμ— ENCRYPTION_KEY μ¶”κ°€ ν•„μ”
  
  node scripts/migrate-naver-passwords.js
  ```

---

### 3λ‹¨κ³„: Rate Limiting (μ™„λ£, κ΄€λ€ν• μ„¤μ •)

#### β… λ΅κ·ΈμΈ μ‹λ„ μ ν•
- **νμΌ**: `lib/rate-limit.ts`, `app/api/auth/login/route.ts`
- **μ„¤μ •**:
  - μµλ€ μ‹λ„ νμ: **10ν**
  - μλ„μ°: **15λ¶„**
  - μ°¨λ‹¨ μ‹κ°„: **30λ¶„**
- **μ‚¬μ©μ μ•λ‚΄**: 
  - 3ν μ΄ν• λ‚¨μ•μ„ λ• κ²½κ³  λ©”μ‹μ§€ ν‘μ‹
  - μ°¨λ‹¨ μ‹ λ‚¨μ€ μ‹κ°„ μ•λ‚΄

---

## π€ μ μ© λ°©λ²•

### Step 1: ν™κ²½ λ³€μ μ„¤μ •

Railway λλ” Vercel ν™κ²½ λ³€μμ— μ¶”κ°€:

```env
ENCRYPTION_KEY=your-32-byte-hex-key-or-random-string
```

**μ•”νΈν™” ν‚¤ μƒμ„± λ°©λ²•**:
```bash
# Node.jsμ—μ„ μ‹¤ν–‰
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**μ¤‘μ”**: μ΄ ν‚¤λ¥Ό μ•μ „ν•κ² λ³΄κ΄€ν•μ„Έμ”. ν‚¤λ¥Ό μƒμ–΄λ²„λ¦¬λ©΄ λ³µνΈν™”ν•  μ μ—†μµλ‹λ‹¤!

### Step 2: λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ…

#### 2-1. RLS μ •μ±… λΉ„ν™μ„±ν™”
Supabase SQL Editorμ—μ„ μ‹¤ν–‰:
```sql
-- supabase/disable-rls-policies.sql νμΌ λ‚΄μ© μ‹¤ν–‰
```

#### 2-2. κΈ°μ΅΄ λ„¤μ΄λ²„ λΉ„λ°€λ²νΈ μ•”νΈν™”
λ΅μ»¬μ—μ„ μ‹¤ν–‰:
```bash
# .env.localμ— ν™κ²½ λ³€μ μ„¤μ • ν›„
node scripts/migrate-naver-passwords.js
```

### Step 3: λ°°ν¬

λ³€κ²½μ‚¬ν•­μ„ μ»¤λ°‹ν•κ³  ν‘Έμ‹:
```bash
git add .
git commit -m "Apply security improvements: encryption, rate limiting, HTTPS"
git push origin main
```

---

## π“‹ μ‚¬μ©μ μ•λ‚΄ λ©”μ‹μ§€

### Rate Limiting μ•λ‚΄

**λ΅κ·ΈμΈ μ‹¤ν¨ μ‹ κ²½κ³  λ©”μ‹μ§€**:
- "λ΅κ·ΈμΈ μ‹λ„κ°€ Xν μ‹¤ν¨ν–μµλ‹λ‹¤. Yν λ” μ‹¤ν¨ν•λ©΄ 30λ¶„κ°„ μ°¨λ‹¨λ©λ‹λ‹¤."

**μ°¨λ‹¨ μ‹ λ©”μ‹μ§€**:
- "λ„λ¬΄ λ§μ€ λ΅κ·ΈμΈ μ‹λ„κ°€ μμ—μµλ‹λ‹¤. Xλ¶„ ν›„μ— λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”."

### κ΄€λ¦¬μ μ•λ‚΄

**λ„¤μ΄λ²„ λΉ„λ°€λ²νΈ μ•”νΈν™”**:
- κΈ°μ΅΄ κΈ°λ¥κ³Ό λ™μΌν•κ² μ‘λ™ν•©λ‹λ‹¤
- μ €μ¥ μ‹ μλ™μΌλ΅ μ•”νΈν™”λ©λ‹λ‹¤
- μ΅°ν μ‹ μλ™μΌλ΅ λ³µνΈν™”λμ–΄ ν‘μ‹λ©λ‹λ‹¤
- λ³µμ‚¬ κΈ°λ¥λ„ μ •μƒμ μΌλ΅ μ‘λ™ν•©λ‹λ‹¤

---

## β… ν™•μΈ μ‚¬ν•­

λ°°ν¬ ν›„ ν™•μΈ:

1. **HTTPS λ¦¬λ‹¤μ΄λ ‰νΈ**
   - HTTPλ΅ μ ‘κ·Ό μ‹ HTTPSλ΅ λ¦¬λ‹¤μ΄λ ‰νΈλλ”μ§€ ν™•μΈ

2. **μ•”νΈν™” μ‘λ™**
   - λ„¤μ΄λ²„ λΉ„λ°€λ²νΈ μ…λ ¥ β†’ μ €μ¥ β†’ μ΅°ν μ‹ μ›λ³Έμ΄ ν‘μ‹λλ”μ§€ ν™•μΈ

3. **Rate Limiting**
   - λ΅κ·ΈμΈ μ‹¤ν¨ μ‹ κ²½κ³  λ©”μ‹μ§€ ν‘μ‹λλ”μ§€ ν™•μΈ
   - 10ν μ‹¤ν¨ μ‹ μ°¨λ‹¨λλ”μ§€ ν™•μΈ

4. **λ΅κΉ…**
   - λ„¤μ΄λ²„ μ •λ³΄ μ΅°ν μ‹ ν™λ™ λ΅κ·Έμ— κΈ°λ΅λλ”μ§€ ν™•μΈ

---

## π” λ³΄μ• κ°•ν™” ν¨κ³Ό

1. **λ°μ΄ν„°λ² μ΄μ¤ λ³΄μ•**
   - λ„¤μ΄λ²„ λΉ„λ°€λ²νΈκ°€ μ•”νΈν™”λμ–΄ μ €μ¥λ¨
   - DB μ μ¶ μ‹μ—λ„ λ³µνΈν™” μ—†μ΄λ” μ‚¬μ© λ¶κ°€

2. **λ¬΄μ°¨λ³„ λ€μ… κ³µκ²© λ°©μ§€**
   - λ΅κ·ΈμΈ μ‹λ„ μ ν•μΌλ΅ κ³µκ²© μ°¨λ‹¨
   - κ΄€λ€ν• μ„¤μ •μΌλ΅ μ •μƒ μ‚¬μ©μ λ¶νΈ μµμ†ν™”

3. **μ ‘κ·Ό μ¶”μ **
   - λ¨λ“  κ°μΈμ •λ³΄ μ ‘κ·Όμ΄ λ΅κ·Έμ— κΈ°λ΅λ¨
   - κ°μ‚¬(Audit) κ°€λ¥

4. **λ„¤νΈμ›ν¬ λ³΄μ•**
   - HTTPS κ°•μ λ΅ μ¤‘κ°„μ κ³µκ²© λ°©μ§€

---

## β οΈ μ£Όμμ‚¬ν•­

1. **μ•”νΈν™” ν‚¤ κ΄€λ¦¬**
   - `ENCRYPTION_KEY`λ” μ λ€ κ³µμ ν•μ§€ λ§μ„Έμ”
   - ν‚¤λ¥Ό μƒμ–΄λ²„λ¦¬λ©΄ λ³µνΈν™” λ¶κ°€λ¥
   - μ •κΈ°μ μΌλ΅ λ°±μ—… ν™•μΈ

2. **κΈ°μ΅΄ λ°μ΄ν„°**
   - λ§μ΄κ·Έλ μ΄μ… μ¤ν¬λ¦½νΈ μ‹¤ν–‰ ν›„ λ¨λ“  ν‰λ¬Έ λ°μ΄ν„° μ•”νΈν™” ν™•μΈ
   - λ§μ΄κ·Έλ μ΄μ… μ „ λ°±μ—… κ¶μ¥

3. **Rate Limiting**
   - μ„λ²„ μ¬μ‹μ‘ μ‹ λ©”λ¨λ¦¬ κΈ°λ° μ €μ¥μ† μ΄κΈ°ν™”λ¨
   - ν”„λ΅λ•μ…μ—μ„λ” Redis λ“±μ„ μ‚¬μ©ν•λ” κ²ƒμ΄ μΆ‹μ

---

## π› λ¬Έμ  ν•΄κ²°

### μ•”νΈν™”/λ³µνΈν™” μ¤λ¥
- `ENCRYPTION_KEY` ν™κ²½ λ³€μ ν™•μΈ
- ν‚¤ ν•μ‹ ν™•μΈ (64μ hex λλ” μ„μ λ¬Έμμ—΄)

### Rate Limiting λ¬Έμ 
- μ„λ²„ μ¬μ‹μ‘μΌλ΅ μ΄κΈ°ν™”λ¨ (μ •μƒ)
- λ©”λ¨λ¦¬ κΈ°λ°μ΄λ―€λ΅ μ—¬λ¬ μ„λ²„ μΈμ¤ν„΄μ¤ μ‚¬μ© μ‹ μ ν•μ΄ λ¶„μ‚°λ  μ μμ

### HTTPS λ¦¬λ‹¤μ΄λ ‰νΈ μ‘λ™ μ• ν•¨
- Railway/Vercelμ€ μλ™μΌλ΅ HTTPS μ κ³µ
- `x-forwarded-proto` ν—¤λ” ν™•μΈ ν•„μ”

---

## π“ λ¬Έμ

λ¬Έμ κ°€ λ°μƒν•λ©΄ λ΅κ·Έλ¥Ό ν™•μΈν•κ±°λ‚ κ΄€λ¦¬μμ—κ² λ¬Έμν•μ„Έμ”.
