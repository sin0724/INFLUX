# 🚨 데이터베이스 수정 필수!

현재 다음 오류가 발생하고 있습니다:
```
주문 생성에 실패했습니다: new row for relation "orders" violates check constraint "orders_taskType_check"
```

이 오류는 **데이터베이스 제약조건** 문제입니다. 반드시 아래 단계를 따라 Supabase에서 SQL을 실행해야 합니다.

## ⚠️ 중요: 코드만으로는 해결되지 않습니다

데이터베이스 스키마 변경은 코드가 아닌 **Supabase SQL Editor**에서 직접 실행해야 합니다.

---

## 📋 실행 방법 (단계별)

### 1단계: Supabase 접속
1. 브라우저에서 https://supabase.com/dashboard 접속
2. 로그인 (필요시)
3. 프로젝트 선택 (INFLUX 프로젝트)

### 2단계: SQL Editor 열기
1. 왼쪽 사이드바에서 **"SQL Editor"** 메뉴 클릭
   - 아이콘: 파란색 데이터베이스 모양
2. **"New query"** 버튼 클릭

### 3단계: SQL 복사 및 붙여넣기
1. 아래 SQL 전체를 **복사** (Ctrl+C 또는 Cmd+C)
2. SQL Editor 텍스트 박스에 **붙여넣기** (Ctrl+V 또는 Cmd+V)

### 4단계: SQL 실행
1. 화면 우측 상단 또는 하단의 **"Run"** 버튼 클릭
2. 또는 키보드 단축키: **Ctrl+Enter** (Windows) 또는 **Cmd+Enter** (Mac)

### 5단계: 결과 확인
- 성공 메시지가 표시되면 완료!
- 오류가 발생하면 오류 메시지를 복사하여 알려주세요

---

## 📝 실행할 SQL (아래 전체 복사)

```sql
-- ============================================
-- 🚨 필수: 이 SQL을 Supabase에서 실행하세요!
-- ============================================

-- orders 테이블의 taskType CHECK 제약조건 업데이트
-- blog, receipt, daangn 추가
ALTER TABLE orders 
DROP CONSTRAINT IF EXISTS orders_taskType_check;

ALTER TABLE orders 
ADD CONSTRAINT orders_taskType_check 
CHECK ("taskType" IN ('follower', 'like', 'hotpost', 'momcafe', 'powerblog', 'clip', 'blog', 'receipt', 'daangn'));

-- 성공 메시지
SELECT '✅ 성공! 모든 taskType이 추가되었습니다!' AS result;

-- 제약조건 확인
SELECT 
    '현재 제약조건' AS info,
    pg_get_constraintdef(oid) AS constraint_definition
FROM pg_constraint 
WHERE conrelid = 'orders'::regclass 
AND conname = 'orders_taskType_check';
```

---

## ✅ 실행 후 확인 사항

SQL 실행 후 결과 창에서:
1. `✅ 성공! 모든 taskType이 추가되었습니다!` 메시지 확인
2. `constraint_definition`에 다음이 모두 포함되어 있는지 확인:
   - `follower`, `like`, `hotpost`, `momcafe`, `powerblog`, `clip`
   - `blog`, `receipt`, `daangn` ← 이 3개가 새로 추가됨

---

## ❓ 문제 해결

### Q: "permission denied" 오류가 발생해요
A: 관리자 계정으로 로그인했는지 확인하세요.

### Q: "relation orders does not exist" 오류가 발생해요
A: 프로젝트를 올바르게 선택했는지 확인하세요.

### Q: SQL을 실행했는데도 여전히 오류가 발생해요
A: 
1. SQL 실행 결과를 확인하여 성공했는지 확인
2. 브라우저 캐시 삭제 후 다시 시도
3. Railway 재배포가 필요할 수 있습니다

---

## 📁 참고 파일

- `EXECUTE_NOW_SIMPLE.sql` - 실행할 SQL 파일 (위와 동일)
- `supabase/COMPLETE_MIGRATION.sql` - 전체 마이그레이션 파일

---

## 🔄 SQL 실행 후 할 일

1. SQL 실행 완료 확인
2. Railway 앱 재시작 (선택사항, 보통 자동 반영됨)
3. 블로그/영수증 리뷰 링크 추가 다시 시도
4. 당근마켓 신청 다시 시도

---

**이 SQL을 실행하지 않으면 오류가 계속 발생합니다!**

